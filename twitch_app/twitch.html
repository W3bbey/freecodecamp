<!DOCTYPE html>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<html>
    
<script>
	
	// Global vars

	// Channel names in the following array must match case with the display name that will be pulled later
	var channelNames = ["NoObjectiveGamingAU", "ESL_SC2", "OgamingSC2", "cretetion", "FreeCodeCamp", "storbeck", "habathcx", "RobotCaleb", "noobs2ninjas"];
	var liveChannels = [];
	var liveChannelNames = [];
	var liveChannelObjects = [];
	var liveObject = "";
	var offlineChannels = [];
	var offlineChannelNames = [];
	var offlineChannelObjects = [];
	var offlineObject = "";
	var streamDetails = [];
	var channelDetails = [];
	var html = "";
	var filterSubjects = "";
	var remainingItems = "";


	$(document).ready(function () {


		// how about a button to get the status rather than document.ready?
		for (var i = 0; i < channelNames.length;i++) {
			
			$.getJSON('https://wind-bow.glitch.me/twitch-api/streams/' + channelNames[i], function(streamData) {
				
				streamDetails.push(streamData);
				
			});
			
			$.getJSON('https://wind-bow.glitch.me/twitch-api/channels/' + channelNames[i], function(channelData) {
				
				channelDetails.push(channelData);
			});
		}
		
		$("#getMessage").on("click", function() {
			
			// These are the live channels, but it contains all the data
			liveChannels = streamDetails.filter(function(channel){
				return(channel.stream != null);
			});
		
			// Attempting to create objects for each live channel
			for (var i = 0; i < liveChannels.length; i++){
				liveChannelNames.push(liveChannels[i].stream.channel.display_name) // this is what I was doing to get the live channel to an array
				liveObject = { 
					"name": liveChannels[i].stream.channel.display_name,
					"logo": liveChannels[i].stream.channel.logo,
					"link": liveChannels[i].stream.channel.url,
					"viewers": liveChannels[i].stream.viewers
				};
				liveChannelObjects.push(liveObject);
			};

			// I don't really understand this .includes thing, but this seems to work
			offlineChannelNames = channelNames.filter(function(item){
				return !liveChannelNames.includes(item);
			})
			
			// The outer loop is intended to run for as many offline channels were identified.
			for (var i = 0; i < offlineChannelNames.length; i++){
				// The inner loop needs to check each of the channels
				for (var j = 0; j < channelDetails.length; j++){
					if (offlineChannelNames[i] == channelDetails[j].display_name){
							offlineObject = {
								"name": channelDetails[j].display_name,
								"logo": channelDetails[j].logo,
								"link": channelDetails[j].url
							};
							offlineChannelObjects.push(offlineObject);
					} else {

					}
				}
			}
			
			console.log(liveChannelObjects);
			console.log(offlineChannelObjects);
			
			// begin all of the HTML assembling to output a nice list of live and offline channels
			
			/* html += "<div class='container-fluid'>";
				html += "<div class='row'>";
					html += "<div class='col-md-offset-4 col-md-4'>";
						// removed the "live channels <p> and just added it in the HTML."
					html += "</div>";
				html += "</div>";
			html += "</div" */
				
			// Organize the live channels
			for (var i = 0; i < liveChannelNames.length; i++) {
				
				//Playing with append, but this doesn't seem to work the way I need it
				// I don't think I can refer to JS variables when using append.
				/* $("#message").append(
					<div class="col-md-2">
						<img style='text-align: center' class='logo' src=liveChannelObjects[i].logo' >
					</div>
				) */
				
				html += "<div class='container'>"
					html += "<div class='row'>";
						
						//html += "<div class='col-md-3'>";
							html += "<img style='text-align: center' class='logo' src='" + liveChannelObjects[i].logo + "'" + ">";
						//html += "</div>";
						
						//html += "<div class='col-md-3>";
							html += "<a href='" + liveChannelObjects[i].link + "'>" + liveChannelObjects[i].name + "</a>";
						//html+= "</div>";
						
						//html += "<div class='col-md-3>"
							html += "<p>Viewers: " + liveChannelObjects[i].viewers + "</p>"
						//html += "</div >"

					html += "</div>"
				html += "</div>"
			}

				html += "<div class='row'>"
					html += "<div class='col-md-offset-5 col-md-2'>"
						html += "<p style='text-align: center;'>Offline Channels: </p>"
					html += "</div>"
				html += "</div>"

			for (var i = 0; i < offlineChannelNames.length; i++){
				
				html += "<p>" + offlineChannelNames[i] + "</p>"
			}
			html += "</div>"
			
			$("#message").html(html);
			
		});

	});
			
		
		/* $("#getMessage").on("click", function() {
			
			html = "";
			
			

			for (var i = 0; i < channelNames.length; i++) {
				
				
				$.getJSON('https://wind-bow.glitch.me/twitch-api/streams/' + channelNames[i], function(streamData) {

					console.log(streamData);

					if (streamData.stream != null) {	
						html += "<div class='streamer'>"
						html += "<img src= '" + streamData.stream.channel.logo + "'" + "height='50' width='50'>";
						html += "<p>" + streamData.stream.channel.display_name + "</p>";
						html += "<p>Viewers: " + streamData.stream.viewers + "</p>";
						if (streamData.stream.channel.mature == true) {
							html += "<p>Mature Channel: yes</p>";
						} else {
							html += "<p>Mature Channel: no</p>";
						}
						html += "<a href='" + streamData.stream.channel.url + "'>" + streamData.stream.channel.status + "</a>";
						html += "<p>Live now!</p>";
						html += "</div>";

						$("#message").html(html);
				
					} else {
						//alert(i);
						//alert(channelNames[i]);
						$.getJSON('https://wind-bow.glitch.me/twitch-api/channels/' + channelNames[i], function(channelData) {
							html += "<div class='streamer'>"
							html += "<img src= '" + channelData.logo + "'" + "height='50' width='50'>";
							html += "<p>" + channelData.display_name + "</p>";
							html += "<p>Offline</p>"
							html += "<p>Followers: " + channelData.followers + "</p>";
							$("#message").html(html);
						});
					}		
				
				});
			};
		}); */

</script>

    <body>
        
        <div class="container">
			<div class="row">
				<div class="col-md-offset-2 col-md-8 well">
					<p style='text-align: center;'> Live Channels:</p>
					<p id="message">This is where the message goes</p>
					<!-- <p style="text-align:center;">Offline Channels</p> -->
				</div>
				
				
				
				<div class="col-md-offset-5 col-md-2">
					<button id="getMessage" class="btn btn-primary">CLICK MEH</button>
				</div>
				</div>
			</div>
        </div>


    </body>


</html>



<style>
	.streamer {
		color: black;
		text-align: left;
	}

	.logo {
		width: 50px;
		height: 50px;
		border-radius: 10px;
	}
</style>